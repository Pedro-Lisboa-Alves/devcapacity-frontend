@page
@model DevCapacityWebApp.Pages.Engineers.EditModel
@await Html.PartialAsync("_Tabs")

<h3>Edit Engineer</h3>

<form method="post" class="mb-3">
  <input type="hidden" asp-for="Engineer.EngineerId" />
  <div class="mb-2">
    <input class="form-control" asp-for="Engineer.Name" />
  </div>
  <div class="mb-2">
    <input class="form-control" asp-for="Engineer.Role" />
  </div>
  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="submit">Save</button>
    <a class="btn btn-secondary" href="/Engineers">Cancel</a>
  </div>
</form>

<hr />

<h4>Engineer Calendar Days</h4>

<form method="get" class="row g-2 align-items-end mb-3">
  <!-- garante que o parâmetro route 'id' é enviado no GET -->
  <input type="hidden" name="id" value="@Model.Engineer.EngineerId" />

  <div class="col-auto">
    <label class="form-label">Filter by Type</label>
    <select class="form-select" name="FilterType" asp-for="FilterType">
      @foreach (var t in Model.AvailableTypes)
      {
        if (t == Model.FilterType)
        {
          <option value="@t" selected>@t</option>
        }
        else
        {
          <option value="@t">@t</option>
        }
      }
    </select>
  </div>

  <div class="col-auto">
    <label class="form-label">Page Size</label>
    <select class="form-select" name="PageSize" asp-for="PageSize">
      @foreach (var s in Model.PageSizeOptions)
      {
        if (s == Model.PageSize)
        {
          <option value="@s" selected>@s</option>
        }
        else
        {
          <option value="@s">@s</option>
        }
      }
    </select>
  </div>

  <div class="col-auto">
    <button class="btn btn-outline-primary">Apply</button>
  </div>
</form>

@if (Model.PagedCalendarDays == null || Model.PagedCalendarDays.Count == 0)
{
  <p class="text-muted">No calendar days for this engineer with the selected filter.</p>
}
else
{
  <div class="table-responsive">
    <table class="table table-sm">
      <thead>
        <tr>
          <th>Date</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        @foreach (var d in Model.PagedCalendarDays)
        {
          <tr>
            <td>@d.Date.ToString("yyyy-MM-dd")</td>
            <td>@d.Type</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <nav aria-label="Pagination" class="mt-2">
    <ul class="pagination">
      <li class="page-item @(Model.Page <= 1 ? "disabled" : "")">
        <a class="page-link" href="?id=@Model.Engineer.EngineerId&FilterType=@Model.FilterType&Page=@(Model.Page-1)&PageSize=@Model.PageSize">Previous</a>
      </li>

      @for (int p = 1; p <= Model.TotalPages; p++)
      {
        <li class="page-item @(p == Model.Page ? "active" : "")">
          <a class="page-link" href="?id=@Model.Engineer.EngineerId&FilterType=@Model.FilterType&Page=@p&PageSize=@Model.PageSize">@p</a>
        </li>
      }

      <li class="page-item @(Model.Page >= Model.TotalPages ? "disabled" : "")">
        <a class="page-link" href="?id=@Model.Engineer.EngineerId&FilterType=@Model.FilterType&Page=@(Model.Page+1)&PageSize=@Model.PageSize">Next</a>
      </li>
    </ul>
  </nav>

  <div class="text-muted mt-1">Showing page @Model.Page of @Model.TotalPages — @Model.TotalCount records total.</div>
}